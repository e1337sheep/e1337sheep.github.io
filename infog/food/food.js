'use strict';$(window).ready(function(){console.log('food.js running'),initShares('food'),$('a.share').map(function(k,l){return l.onclick=PopupHandler}),updateOGMeta('https://e1337sheep.github.io/infog/food/images/food.png'),updateSchema('food'),updateSocialText('This is pre game, no score yet');
var b={},d=document.getElementById('food'),e=d.getContext('2d'),f=initCanvasStatus();window.requestAnimationFrame(function(){return renderScene(f,e)});var g=f.addElement(initPreSpin());$('#wrapper img[id]').map(function(k,l){return b[grta.dashToCamel(l.id)]=l.src}),grta.preLoadImages(b,function(k){images=k,d.onselectstart=function(){return!1},globStat=f,scaleFactor=grta.calcScale('food'),[initPizza,initBottles,initGrapes,initBowls,initJellies,initChopsticks,initIceCreamToss].map(function(p){return f.addElement(p())});
var l=f.elements.find(function(p){return'jellyStage'===p.type});l.addJelly(l,f);
var m=f.elements.find(function(p){return'bottleStage'===p.type});m.addBottle(m,f),[{func:initWhiteGrape,x:160,y:-60,rot:0},{func:initRedGrape,x:150,y:-10,rot:0},{func:initWhiteGrape,x:230,y:-80,rot:0},{func:initRedGrape,x:350,y:-20,rot:0},{func:initWhiteGrape,x:400,y:-80,rot:0},{func:initRedGrape,x:520,y:10,rot:0},{func:initRedGrape,x:540,y:-10,rot:0}].map(function(p){return f.addElement(p.func(p.x,p.y,p.rot))}),[{x:-10,y:220,rot:50},{x:510,y:100,rot:-100}].map(function(p){return f.addElement(initHands(p.x,p.y,p.rot))}),[{text:'You could eat 96,360 grapes',w:30,h:6,x:50,y:5},{text:'British people will have drunk over 4,000,000 bottles of wine',w:30,h:11,x:60,y:60},{text:'You could throw and catch 33,000 scoops of ice-cream',w:20,h:15,x:3,y:70}].map(function(p){f.addElement(initCaptionHTML(p.text,p.w,p.h,p.x,p.y,p.rot))}),g.finish(g,d),window.setInterval(function(){return l.addJelly(l,f)},1000),window.setInterval(function(){return m.addBottle(m,f)},10),window.setInterval(function(){return f.addElement(initIceCream())},1000);
var n=['xpos','ypos','scale','opacity','rotation'],o=new DeltaTimer(function(p){f=grta.updateElements(f,n,p)},1000/60);
o.start(),$('#food').click(function(p){f.elements.filter(function(q){return!0==q.clickable}).map(function(q){q.hasClicked(q,p)&&q.on_click(q,p,f)})}),$(window).resize(function(p){scaleFactor=grta.calcScale('food')}),TweenMax.to('#food',0.8,{opacity:1}),TweenMax.to('#social-links h3',1,{textShadow:'1px 1px 10px rgba(255,255,255,1)                  ,-1px -1px 10px rgba(255,255,255,1)',yoyo:!0,repeat:-1,delay:20})})});
var initPizza=function initPizza(){var b=grta.createElement();return b.type='pizza',b.image=images.pizzaGaps,b.imgWidth=b.image.width,b.imgHeight=b.image.height,b.gameID='pizza',b.captionID='pizzaCap',b.preCaption='You could make 6910 pizzas.                        How many can you make in 22 seconds?',b.postCaption=function(d){return'You made '+d.score+' pizzas.                                  Is that the best you\'ve got?'},b.on_gameEnd=function(d){updateSocialText('I made '+d.score+' pizzas.  Can you do better?'),$('#social-links h3').html('Share your High Score of '+d.score+'!')},b.score=0,b.initialScale=0.5,b.xpos=0,b.ypos=0,initCaptionHTML(b.preCaption,24,15,2.7,20,0,b.captionID),b.drawPizza=b.draw,b.draw=function(d,e,f){d.drawPizza(d,e,f),f.elements.filter(function(g){return'pizza'===g.render}).map(function(g){return g.draw(g,e,f)})},b.clickable=!0,b.clickAreas.push([34,33,346,342]),b.on_click=function(d,e,f){'ready'===f.gameStatus&&(console.log('Pizza Game Started'),f.elements.filter(function(g){return'topping'===g.type}).map(function(g){return g.opacity=0}),!f.elements.filter(function(g){return'topping'===g.type}).length&&[{x:37,y:40,scale:0.5},{x:57,y:27,scale:0.5},{x:88,y:22,scale:0.5},{x:115,y:33,scale:0.5},{x:140,y:57,scale:0.5},{x:147,y:88,scale:0.5},{x:20,y:71,scale:0.5},{x:82,y:43,scale:0.53},{x:59,y:57,scale:0.53},{x:117,y:67,scale:0.5},{x:43,y:80,scale:0.5},{x:85,y:87,scale:0.5},{x:115,y:96,scale:0.52},{x:23,y:106,scale:0.5},{x:65,y:113,scale:0.5},{x:99,y:113,scale:0.53},{x:132,y:118,scale:0.52},{x:49,y:140,scale:0.5},{x:76,y:149,scale:0.5},{x:109,y:140,scale:0.5}].map(function(g){return f.addElement(initTopping(g.x,g.y,g.scale))}),f.currentGame='pizza',f.gameStatus='started',f.subScore=0,TweenMax.to('#'+d.captionID,0.4,{opacity:0}),f.addElement(initClock(300,160)),initCaptionHTML('Click the Gaps to place toppings',24,10,2.7,30,0,'pizzaRules'),TweenMax.to('#pizzaRules',0.4,{opacity:0,delay:2,onComplete:function onComplete(){f.elements.find(function(g){return'captionHTML'===g.type&&'pizzaRules'===g.id}),$('#pizzaRules').remove()}}))},b},initTopping=function initTopping(b,d,e){var f=grta.createElement();return f.type='topping',f.render='pizza',f.image=images.pepperoniSmall,f.initialScale=e,f.imgWidth=f.image.width,f.imgHeight=f.image.height,f.xpos=b,f.ypos=d,f.opacity=0,f.scale=1,f.clickable=!0,f.clickAreas.push([2,2,45,45]),f.on_click=function(g,k,l){0===g.opacity&&(l.subScore+=1),TweenMax.fromTo(g,0.2,{opacity:0,scale:2},{opacity:1,scale:1}),20<=l.subScore&&function(){l.subScore=0,l.score+=1,l.addElement(initFlyout(l.score,g.xpos,g.ypos));var m=l.elements.find(function(p){return'pizza'===p.gameID}),n=l.elements.filter(function(p){return'topping'===p.type}),o=[m].concat(n);TweenMax.to(o,0.2,{xpos:'-=200',onComplete:function onComplete(){l.elements.filter(function(p){return'topping'===p.type}).map(function(p){return p.opacity=0}),TweenMax.to(o,0.2,{xpos:'+=200'})}})}()},f},initGrapes=function initGrapes(){var b=grta.createElement();return b.type='grapeStage',b.xpos=0,b.ypos=0,b.draw=function(d,e,f){f.elements.filter(function(g){return g.render===b.type}).map(function(g){return g.draw(g,e)})},b},initRedGrape=function initRedGrape(b,d,e,f){var g=grta.createElement();return g.type='redGrapes',g.render='grapeStage',g.image=images.grapesRed,g.imgWidth=g.image.width,g.imgHeight=g.image.height,g.initialScale=0.25,g.xpos=b||0,g.ypos=d||0,g.rotation=e||0,g.scale=f?-1:1,g},initWhiteGrape=function initWhiteGrape(b,d,e){var f=grta.createElement();return f.type='whiteGrapes',f.render='grapeStage',f.image=images.grapesWhite,f.imgWidth=f.image.width,f.imgHeight=f.image.height,f.initialScale=0.7,f.xpos=b||0,f.ypos=d||0,f.rotation=e||0,f},initIceCreamToss=function initIceCreamToss(){var b=grta.createElement();return b.type='iceCreamStage',b.draw=function(d,e,f){f.elements.filter(function(g){return'iceCreamStage'===g.render&&'icecream'===g.type}).map(function(g){return g.draw(g,e)}),f.elements.filter(function(g){return'iceCreamStage'===g.render&&'hands'===g.type}).map(function(g){return g.draw(g,e)})},b},initIceCream=function initIceCream(){var b=grta.createElement();b.type='icecream',b.render='iceCreamStage';var d=[images.iceCreamChoc,images.iceCreamPink,images.iceCreamMint],e=Math.floor(3*Math.random());return b.image=d[e],b.imgWidth=b.image.width,b.imgHeight=b.image.height,b.initialScale=0.3,b.xpos=0,b.ypos=300,TweenMax.to(b,1,{xpos:685,rotation:-180}),TweenMax.to(b,1,{ypos:150,ease:Circ.easeOut,onComplete:function onComplete(){return b.remove=!0}}),b},initHands=function initHands(b,d,e){var f=grta.createElement();f.type='hands',f.render='iceCreamStage';var g=document.createElement('canvas');g.width=1.5*images.handLeft.width,g.height=images.handLeft.height;var k=g.getContext('2d');return k.drawImage(images.handLeft,0,0),k.scale(-1,1),k.drawImage(images.handLeft,1.5*-images.handLeft.width,0),f.image=g,f.imgWidth=f.image.width,f.imgHeight=f.image.height,f.initialScale=0.7,f.xpos=b,f.ypos=d,f.rotationX=f.imgWidth/4,f.rotationY=f.imgHeight/4,f.rotation=e,f},initBottles=function initBottles(){var b=grta.createElement();return b.type='bottleStage',b.xpos=270,b.ypos=100,b.locations=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],b.addBottle=function(d,e){var f=!1;d.locations.map(function(g,k,l){var m=e.elements.filter(function(n){return'bottle'==n.type&&n.index==k}).length;if(m||2!=g||(l[k]=1),!f&&1==g){var n=initBottle();n.xpos=d.xpos+Math.floor(k/3)*(n.imgWidth*n.initialScale),n.ypos=d.ypos+k%3*(n.imgHeight*n.initialScale),n.index=k,e.addElement(n),f=!0,l[k]=2}})},b.draw=function(d,e,f){f.elements.filter(function(g){return'bottleStage'===g.render}).map(function(g){return g.draw(g,e)})},b},initBottle=function initBottle(){var b=grta.createElement();return b.type='bottle',b.render='bottleStage',b.shadow=!1,b.image=images.wineBottle,b.imgWidth=b.image.width,b.imgHeight=b.image.height,b.initialScale=0.25,b.opacity=0,TweenMax.to(b,0.4,{opacity:1}),b},initBowls=function initBowls(){var b=grta.createElement();return b.type='bowl',b.image=images.bowlEmpty,b.imgWidth=b.image.width,b.imgHeight=b.image.height,b.initialScale=0.4,b.xpos=43,b.ypos=326,b.draw=function(d,e,f){e.save(),e.globalAlpha=d.opacity;var g=d.xpos+d.rotationX,k=d.ypos+d.rotationY;e.translate(g,k),e.rotate(d.rotation*Math.PI/180),e.translate(-g,-k),e.scale(d.trueScale(d),d.trueScale(d)),e.translate(d.xpos/d.trueScale(d),d.ypos/d.trueScale(d)),[1,2,3,4,5,6].map(function(l){e.drawImage(d.image,d.frameOffset(d),0,d.imgWidth,d.imgHeight,d.imgWidth*l,0,d.imgWidth,d.imgHeight)}),e.restore()},b},initChopsticks=function initChopsticks(){var b=grta.createElement();return b.type='sticks',b.image=images.chopsticks,b.imgWidth=b.image.width,b.imgHeight=b.image.height,b.initialScale=0.25,b.xpos=100,b.ypos=100,b.rotationX=b.imgWidth/4,b.rotationY=b.imgHeight/4,b.rotation=-90,b},initJellies=function initJellies(){var b=grta.createElement();return b.type='jellyStage',b.gameID='eatJelly',b.captionID='eat-jelly',b.preCaption='You could eat 8,751kg of jelly with chopsticks.                          How much can you eat in 22 seconds?',b.postCaption=function(d){return'You ate '+d.score+' bowls of jelly in 22 seconds.                                  Hungry for more?'},b.score=0,b.xpos=150,b.ypos=300,b.locations=[1,1,1,1,1],initCaptionHTML(b.preCaption,41,12,45,85,0,b.captionID),b.addJelly=function(d,e){var f=!1;d.locations.map(function(g,k,l){var m=e.elements.filter(function(n){return'jelly-bowl'==n.type&&n.index==k}).length;if(m||2!=g||(l[k]=1),!f&&1==g){var n=initJelly();n.xpos=d.xpos+k*(n.imgWidth*n.initialScale+18),n.ypos=d.ypos,n.index=k,e.addElement(n),f=!0,l[k]=2}})},b.on_gameEnd=function(d){updateSocialText('I ate '+d.score+' bowls of jelly.  Can you do better?'),$('#social-links h3').html('Share your High Score of '+d.score+'!'),d.elements.filter(function(e){return'jelly-bowl'===e.type}).map(function(e){e.clickable=!1,TweenMax.to(e,0.4,{opacity:0,onComplete:function onComplete(){return e.remove=!0}})})},b.draw=function(d,e,f){f.elements.filter(function(g){return'jellyStage'===g.render}).map(function(g){return g.draw(g,e)})},b},initJelly=function initJelly(){var b=grta.createElement();return b.type='jelly-bowl',b.render='jellyStage',b.image=images.jelly,b.shadow=!1,b.imageBites=0,b.images={jelly:images.jelly,bowl:images.bowlEmpty,sticks:images.chopsticks},b.initialScale=0.35,b.imgHeight=b.image.height,b.imgWidth=b.image.width,b.opacity=0,TweenMax.to(b,0.4,{opacity:1}),b.bites=0,b.biteLimit=4,b.clickable=!0,b.clickAreas.push([0,0,b.imgWidth,b.imgHeight]),b.on_click=function(d,e,f){var g=f.elements.find(function(k){return'eatJelly'==k.gameID});if('started'===f.gameStatus&&'eatJelly'===f.currentGame){d.bites+=1,d.bites>=d.biteLimit&&(f.score+=1,f.addElement(initFlyout(f.score,d.xpos,d.ypos)),d.clickable=!1,TweenMax.to(d,0.3,{opacity:0,onComplete:function onComplete(){return d.remove=!0}}));;}'ready'===f.gameStatus&&(console.log('Starting Jelly Game'),f.currentGame='eatJelly',f.gameStatus='started',TweenMax.to('#'+g.captionID,0.4,{opacity:0}),f.addElement(initClock(300,160)),d.bites+=1)},b.drawJelly=b.draw,b.draw=function(d,e,f){if(d.bites>d.imageBites){var g=document.createElement('canvas'),k=g.getContext('2d');k.width=d.imgWidth,k.height=d.imgHeight,k.drawImage(d.image,d.frameOffset(d),0,d.imgWidth,d.imgHeight,0,0,d.imgWidth,d.imgHeight),k.globalCompositeOperation='destination-out',k.beginPath(),k.arc(d.bites*d.imgWidth/4,d.imgHeight/3,d.imgWidth/4,0,2*Math.PI),k.fill(),d.image=g}d.drawJelly(d,e,f)},b};
